name: cleanup
description: Cleanup branches after Pull Request is closed
inputs:
  github-token:
    default: ${{ github.token }}
    description: The GitHub Token
    required: false
  head-ref:
    default: ${{ github.head_ref }}
    description: The head branch to delete
    required: false
  pull-request-url:
    description: The Pull Request URL
    required: true
runs:
  using: composite
  steps:
    - id: stack
      uses: shikanime-studio/actions/stack@main
      with:
        github-token: ${{ inputs.github-token }}
        pull-request-url: ${{ inputs.pull-request-url }}
    - env:
        HEAD_REF: ${{ inputs.head-ref }}
      if: ${{ steps.stack.outputs.method == 'github-pull-request' }}
      run: git push origin --delete "$HEAD_REF" || true
      shell: bash
    - env:
        HEAD_REF: ${{ inputs.head-ref }}
      if: ${{ steps.stack.outputs.method == 'ghstack' }}
      run: |
        for role in base head orig; do
          git push origin --delete "${HEAD_REF%/head}/$role" || true
        done
      shell: bash
